common: &common
  run_type: create        # create, use, json
  bucket_name: 13b-266
  width: 4
  shutdown: True
  use_bash: True
  volume: /mnt/daliuge/dlg_root
  split_directory: split_4_phase_1
  uvsub_directory_name: uvsub_ha_2019_02_03
  clean_directory_name: tclean_ha_2019_02_13
  casa_version: '5.5'     # allowed=['4.7', ''5.5'],
  ami: ami-052813d2e49fbdf18
  spot_price_i3_2xlarge: 0.4
  spot_price_i3_4xlarge: 0.8
  spot_price_i3_8xlarge: 1.2
  spot_price_i3_16xlarge: 1.9
  dump_json: False
  nodes: 1    # Fail-safe in case nodes is not specified
  dim: 128.0.0.1
  log_level: vvv
  w_projection_planes: 24
  s3_storage_class: INTELLIGENT_TIERING
  # 'STANDARD'|'REDUCED_REDUNDANCY'|'STANDARD_IA'|'ONEZONE_IA'|'INTELLIGENT_TIERING'|'GLACIER'|'DEEP_ARCHIVE'

split:
  <<: *common
  action: split
  observation_phase: 2
  run_note: |
    First run of the new split.
    Maintaining native frequency frame (TOPO)
  days_per_node: 3
  parallel_streams: 4
  s3_storage_class: INTELLIGENT_TIERING

uvsub_node1:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  mode: 'major-2'
  w_projection_planes: 99
  uvsub_directory_name: uvsub_maj2_2019_07_08_Wplane_99
  scan_statistics: True
  produce_qa: True
  frequency_range:      # This should be a list
    - '999-1001'
  nodes: 1
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Using major-2 and 99 planes

uvsub:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  scan_statistics: False
  produce_qa: True
  frequency_range:      # This should be a list
  nodes: 5
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Using new model (CI) - following new workflow plan as per MM & AP
    aka channalised outlier models now stand alone (for absorption)
    and matching (smaller) in beam models

uvsub_major1:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  mode: 'major-1'  # is this limited in values???
  uvsub_directory_name: uvsub_2V2_2020_09_05
  scan_statistics: False
  frequency_range:      # This should be a list
    -  '1124-1144'  #'948-1204'
  #  - '948-967'
  #  - '950-1419'
  produce_qa: True
  nodes: 10
  run_note_uvsub: |
    Introduce fixed Outlier 8. |u|<10 flagging

uvsub_abs:
  <<: *common
  action: uvsub
  number_taylor_terms: 0
  #mode: 'absorption'  # is this limited in values???
  uvsub_directory_name: uvsub_maj2_2019_07_25_Abs
  scan_statistics: False
  frequency_range:      # This should be a list
    - '950-1219'
  produce_qa: True
  nodes: 10
  run_note_uvsub: |
    Using new model of the outliers
    try to branch into absorption

uvsub_ska:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  scan_statistics: False
  produce_qa: True
  frequency_range:      # This should be a list
  nodes: 5
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Demo in SKA meeting.
    New models provided

clean:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_maj1_2020_08_25
  clean_directory_name: clean_2020_08_25_Low
  frequencies_per_node: 1
  iterations: 2000
  arcsec: '1.5'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 2
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'               # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
     - '1025-1047'  #
  #    - '1381-1419'    ## Absorption
  #   - '1069-1101'    ## Low (1.5)
  #    - '1365-1419'   ## High (1.5)
  casa_version: '5.5'           # Clean works better with this version
  s3_storage_class: INTELLIGENT_TIERING
  #s3_tags:
  #  - move_to_glacier: True
  run_note_clean: |
    New Models, Narrow channels, 1 block

clean_wide:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_2V2_2020_09_05
  clean_directory_name: clean_2V2_2020_09_05_Low_Wide
  frequencies_per_node: 1
  iterations: 2000
  arcsec: '3'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 8      # Note a pre-averaging of 2 is now hardwired into the uvsub step
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'        # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
    - '1136-1146'
  #  - '1025-1031'
  casa_version: '5.5'           # Clean works better with this version
  run_note_clean: |
    With new MSMFS models (inc 8) and new uvsub method, 2k interations

clean_hwide:
  <<: *common
  action: clean
  uvsub_directory_name: semester_1/uvsub_2V2_2020_09_05
  clean_directory_name: clean_2V2_2020_09_05_High_Wide
  frequencies_per_node: 1
  iterations: 2000
  arcsec: '2'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 8
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'        # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
    - '1200-1220'
  casa_version: '5.5'           # Clean works better with this version
  run_note_clean: |
    With new MSMFS models and new uvsub method

clean_very_wide:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_maj2_2019_07_06
  clean_directory_name: clean_ha_2019_07_16_Very_Wide
  frequencies_per_node: 4
  nodes: 5
  iterations: 35000
  arcsec: '2'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 128
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'     # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
    - '1212-1300'
  casa_version: '5.5'           # Clean works better with this version
  run_note_clean: |
    Found residuals still had significant flux. Relaunch with double no iterations


imageconcat:
  <<: *common
  action: imageconcat
  imageconcat_width: 6         # the number of frequency blocks to add together
  imageconcat_directory_name: semester_1/imageconcat_2V2_2020_09_05_Low_Wide
  clean_directory_name: clean_2V2_2020_09_05_Low_Wide
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fit_order: 1                 # The fit order0
  frequency_range:              # This should be a list
    - '1125-1144'  # '950-1200' # 1200-1419'     #
  fits_directory_name: 'fits'       # Where to put the fits images
  s3_tags:
    - move_to_glacier: True
  s3_storage_class: INTELLIGENT_TIERING
  run_note_imageconcat: |
    New Models

check_uvsub:
  frequency_range:

split_rgd:
  <<: *common
  action: split
  observation_phase: 1
  run_note: |
    RGD test space
    for messing abut
  days_per_node: 3
  parallel_streams: 1
  split_directory: split_4_rgd
  s3_storage_class: INTELLIGENT_TIERING

uvsub_node1_rgb:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  scan_statistics: False
  produce_qa: True
  frequency_range:
    - '1145-1146'
  uvsub_directory_name: uvsub_test_2019_02_27
  nodes: 1
  log_level: v
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Using new model (CI) - following new workflow plan as per MM & AP
    aka channalised outlier models now stand alone (for absorption)
    and matching (smaller) in beam models

