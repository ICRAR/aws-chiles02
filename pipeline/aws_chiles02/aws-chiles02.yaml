common: &common
  run_type: create        # create, use, json
  bucket_name: 13b-266
  width: 4
  shutdown: True
  use_bash: True
  volume: /mnt/daliuge/dlg_root
  split_directory: split_4_phase_1
  uvsub_directory_name: uvsub_ha_2019_02_03
  clean_directory_name: tclean_ha_2019_02_13
  casa_version: '5.7'     # allowed=['4.7', ''5.5'. '5.7'],
  ami: ami-026c9160706f1e18d
  # Previous (Sept): ami-0f666972d736bdf95
  spot_price_i3_2xlarge: 0.4
  spot_price_i3_4xlarge: 0.8
  spot_price_i3_8xlarge: 1.2
  spot_price_i3_16xlarge: 1.9
  dump_json: False
  nodes: 1    # Fail-safe in case nodes is not specified
  dim: 128.0.0.1
  log_level: vvv
  w_projection_planes: 24
  s3_storage_class: INTELLIGENT_TIERING
  # 'STANDARD'|'REDUCED_REDUNDANCY'|'STANDARD_IA'|'ONEZONE_IA'|'INTELLIGENT_TIERING'|'GLACIER'|'DEEP_ARCHIVE'

split:
  <<: *common
  action: split
  observation_phase: 2
  run_note: |
    First run of the new split.
    Maintaining native frequency frame (TOPO)
  days_per_node: 3
  parallel_streams: 4
  s3_storage_class: INTELLIGENT_TIERING

split_2:
  <<: *common
  action: split
  observation_phase: 2
  run_note: |
    Splitting the new semester for the lowest freq
    MS are not zipped
  days_per_node: 300  # TODO:
  parallel_streams: 4
  s3_storage_class: INTELLIGENT_TIERING
  split_directory: split_4_phase_2
  source_ms_dir: semester_2

uvsub_node1:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  mode: 'major-2'
  w_projection_planes: 99
  uvsub_directory_name: uvsub_maj2_2019_07_08_Wplane_99
  scan_statistics: True
  produce_qa: True
  frequency_range:      # This should be a list
    - '999-1001'
  nodes: 1
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Using major-2 and 99 planes

uvsub:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  scan_statistics: False
  produce_qa: True
  frequency_range:      # This should be a list
  nodes: 5
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Using new model (CI) - following new workflow plan as per MM & AP
    aka channalised outlier models now stand alone (for absorption)
    and matching (smaller) in beam models

uvsub_major1:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  mode: 'major-1'  # is this limited in values???
  uvsub_directory_name: uvsub_2V4_2020_12_09
  scan_statistics: False
  frequency_range:      # This should be a list
    -  '975-983'
    -  '1005-1015'
    -  '1078-1079'
    -  '1105-1111'
    -  '1163-1176'
    -  '1199-1207'
    -  '1229-1239'
    -  '1253-1257'
    -  '1037-1047'
    -  '1133-1143'
    -  '1325'
  # - '973-983','1005-1015','1037-1047','1077-1079','1105-1111','1133-1139','1143','1165-1175','1197-1207','1229-1239','1257','1253-1255','1325'
  #  - '948-967'
  #  - '950-1419'
  produce_qa: True
  nodes: 6
  run_note_uvsub: |
    Epoch 1.  model 2V4

uvsub_abs:
  <<: *common
  action: uvsub
  number_taylor_terms: 0
  #mode: 'absorption'  # is this limited in values???
  uvsub_directory_name: uvsub_maj2_2019_07_25_Abs
  scan_statistics: False
  frequency_range:      # This should be a list
    - '950-1219'
  produce_qa: True
  nodes: 10
  run_note_uvsub: |
    Using new model of the outliers
    try to branch into absorption

uvsub_ska:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  scan_statistics: False
  produce_qa: True
  frequency_range:      # This should be a list
  nodes: 5
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Demo in SKA meeting.
    New models provided

clean:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_maj1_2020_08_25
  clean_directory_name: clean_2020_08_25_Low
  frequencies_per_node: 1
  iterations: 2000
  arcsec: '1.5'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 2
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'               # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
     - '1025-1047'  #
  #    - '1381-1419'    ## Absorption
  #   - '1069-1101'    ## Low (1.5)
  #    - '1365-1419'   ## High (1.5)
  casa_version: '5.5'           # Clean works better with this version
  s3_storage_class: INTELLIGENT_TIERING
  #s3_tags:
  #  - move_to_glacier: True
  run_note_clean: |
    New Models, Narrow channels, 1 block

clean_wide:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_2V4_2020_12_09
  clean_directory_name: clean_2V4_2020_12_09_Low_Wide
  frequencies_per_node: 1
  iterations: 200
  arcsec: '3'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 8      # Note a pre-averaging of 2 is now hardwired into the uvsub step
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'        # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
   - '1009-1015'
   - '1041-1047'
   - '1078-1079'
   - '1105-1111'
   - '1133-1143'
   - '1163-1176'
   - '1200'
   - '975-983'
  run_note_clean: |
    new model 2v4 and new regions

clean_hwide:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_2V4_2020_12_09
  clean_directory_name: clean_2V4_2020_12_09_High_Wide
  frequencies_per_node: 1
  iterations: 200
  arcsec: '2'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 8
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'        # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
   - '1325'
   - '1199-1207'
   - '1229-1239'
   - '1253-1257'
  run_note_clean: |
    DR2V4  -- model

clean_very_wide:
  <<: *common
  action: clean
  uvsub_directory_name: uvsub_maj2_2019_07_06
  clean_directory_name: clean_ha_2019_07_16_Very_Wide
  frequencies_per_node: 4
  nodes: 5
  iterations: 35000
  arcsec: '2'                   # Needs to be a string
  w_projection_planes: 24
  clean_weighting_uv: briggs    # Allow=[briggs, uniform, natural]
  robust: 0.8                   # Robustness of the Briggs
  image_size: 4096
  clean_channel_average: 128
  region_file: '/home/ec2-user/aws-chiles02/LSM/Clean_Regions_All.crtf'     # The region file for cleaning in crtf
  only_image: False             # Only copy the image to S3
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fits_directory_name: ''       # Where to put the fits images
  produce_qa: yes               # allowed=[yes, no]
  clean_tclean: tclean          # allowed=[tclean, clean]
  frequency_range:              # A list of frequency ranges
    - '1212-1300'
  run_note_clean: |
    Found residuals still had significant flux. Relaunch with double no iterations

stats:
  <<: *common
  action: stats
  uvsub_directory_name: uvsub_2V4_2020_12_09
  stats_directory_name: stats_2V4_2020_12_09
  frequencies_per_node: 1
  frequency_range:              # A list of frequency ranges
  # - '1325'
   - '1300-1419'
  run_note_stats: |
    first try of stats as standalone


imageconcat:
  <<: *common
  action: imageconcat
  imageconcat_width: 6         # the number of frequency blocks to add together
  imageconcat_directory_name: semester_1/imageconcat_2V4_2020_12_09_Low_Wide
  clean_directory_name: clean_2V4_2020_12_09_Low_Wide
  build_fits: no                # build the fits files for JPEG2000 allowed=[yes, no]
  fit_order: 1                 # The fit order0
  frequency_range:              # This should be a list
    - '1105-1204'
    - '965-987'
    - '1005-1087'
  fits_directory_name: 'fits'       # Where to put the fits images
  s3_tags:
    - move_to_glacier: True
  s3_storage_class: INTELLIGENT_TIERING
  run_note_imageconcat: |
    Epoch 1 combined V3 and V4

check_uvsub:
  frequency_range:

split_rgd:
  <<: *common
  action: split
  observation_phase: 1
  run_note: |
    RGD test space
    for messing abut
  days_per_node: 3
  parallel_streams: 1
  split_directory: split_4_rgd
  s3_storage_class: INTELLIGENT_TIERING

uvsub_node1_rgb:
  <<: *common
  action: uvsub
  number_taylor_terms: 2
  scan_statistics: False
  produce_qa: True
  frequency_range:
    - '1145-1146'
  uvsub_directory_name: uvsub_test_2019_02_27
  nodes: 1
  log_level: v
  s3_storage_class: INTELLIGENT_TIERING
  run_note_uvsub: |
    Using new model (CI) - following new workflow plan as per MM & AP
    aka channalised outlier models now stand alone (for absorption)
    and matching (smaller) in beam models

